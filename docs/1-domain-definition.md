# Python Judge 도메인 정의서

**버전**: 1.2
**최종 수정일**: 2025-11-25
**상태**: 개정

## 변경 이력

| 버전 | 날짜       | 변경 내용                                                                          | 작성자 |
| ---- | ---------- | ---------------------------------------------------------------------------------- | ------ |
| 1.0  | 2025-11-25 | 초안 작성                                                                          | Claude |
| 1.1  | 2025-11-25 | 도메인 속성 보완, 보안 도메인 추가, 비즈니스 규칙 구체화, 용어 수정                | Claude |
| 1.2  | 2025-11-25 | Docker 의존성 제거, Python 기반 보안 메커니즘으로 변경 (AST 분석, subprocess 격리) | Claude |

## 1. 개요

Python Judge는 Python 알고리즘 코딩 테스트를 온라인으로 수행할 수 있는 교육용 플랫폼입니다. 학생들은 문제를 풀고 즉시 자동 채점을 받을 수 있으며, 관리자는 학생들의 학업 성취도를 효율적으로 평가할 수 있습니다.

## 2. 핵심 도메인

### 2.1 사용자 관리 (User Management)

#### 학생 (Student)

- **속성**
  - 학생 ID (PK, 자동 생성)
  - 군번 (고유 식별 번호, Unique)
  - 로그인 ID (Unique)
  - 이름
  - 비밀번호 (암호화 저장)
  - 이메일 (선택)
  - 소속 정보 (반, 기수)
  - 계정 상태 (활성/비활성/정지)
  - 등록일
  - 최종 접속일
- **행위**
  - 회원가입
  - 로그인/로그아웃
  - 프로필 조회/수정
  - 문제 조회/검색
  - 코드 제출
  - 제출 이력 조회
  - 자신의 성취도 조회

#### 관리자 (Administrator)

- **속성**
  - 관리자 ID (PK, 자동 생성)
  - 로그인 ID (Unique)
  - 이름
  - 비밀번호 (암호화 저장)
  - 권한 레벨 (최고 관리자/일반 관리자)
  - 계정 상태 (활성/비활성)
  - 등록일
  - 최종 접속일
- **행위**
  - 로그인/로그아웃
  - 문제 등록/수정/삭제
  - 테스트 케이스 관리
  - 교육 세션 관리
  - 학생 관리
  - 성취도 평가
  - 시스템 설정 관리

### 2.2 문제 관리 (Problem Management)

#### 알고리즘 문제 (Algorithm Problem)

- **속성**
  - 문제 ID (PK, 자동 생성)
  - 문제 제목
  - 문제 설명 (프로그램 기능, 입출력 범위)
  - 카테고리
  - 난이도 (1-5단계)
  - 예제 입출력
  - 제약 조건
  - 시간 제한 (초, 기본값: 2초)
  - 메모리 제한 (MB, 기본값: 256MB)
  - 작성자 (관리자 ID)
  - 생성일
  - 수정일
  - 공개 상태 (공개/비공개/예약)
  - 정답률 (통계)
  - 제출 횟수 (통계)
- **행위**
  - 문제 조회
  - 문제 필터링 (카테고리별, 난이도별)
  - 문제 검색 (제목, 내용)

#### 카테고리 (Category)

- **분류 체계**
  1. 변수, 연산자, 자료형
  2. 조건문
  3. 문자열
  4. 리스트, 튜플
  5. 반복문
  6. 딕셔너리, 집합
  7. 함수
  8. 파일 입/출력
  9. 클래스
  10. 예외 처리
  11. 모듈과 패키지

#### 문제 세트 (Problem Set)

- **구성**
  - 조건문 문제 세트
  - 반복문 문제 세트
  - 딕셔너리 문제 세트
  - 파일 입/출력 문제 세트
  - 예외 처리 문제 세트

#### 테스트 케이스 (Test Case)

- **속성**
  - 테스트 케이스 ID (PK, 자동 생성)
  - 문제 ID (FK)
  - 입력 데이터
  - 예상 출력 데이터
  - 공개 여부 (학생에게 보이는지 여부)
  - 테스트 케이스 번호 (순서)
  - 생성일
  - 수정일
- **특징**
  - 학생에게는 일부 테스트 케이스만 예시로 제공 (1-3개)
  - 채점 시에는 전체 테스트 케이스로 평가 (10-50개)
  - 학생은 어떤 테스트 케이스에서 틀렸는지 확인 불가
  - 출력 비교: trailing whitespace 무시, 줄바꿈 정규화

### 2.3 제출 및 채점 (Submission and Judging)

#### 코드 제출 (Code Submission)

- **속성**
  - 제출 ID (PK, 자동 생성)
  - 제출자 (학생 ID, FK)
  - 문제 ID (FK)
  - 세션 ID (FK, 선택)
  - 제출 코드 (.py 파일)
  - 코드 크기 (최대 64KB)
  - 제출 시각
  - 채점 상태 (대기/pending, 채점중/judging, 완료/completed, 실패/failed)
  - 채점 결과 ID (FK)
  - Python 버전 (3.8/3.9/3.10/3.11/3.12)
- **행위**
  - 코드 제출
  - 제출 이력 조회
  - 제출 취소 (채점 대기 중인 경우)

#### 자동 채점 시스템 (Auto Judging System)

- **기능**
  - Python 코드 실행 (별도 프로세스, 제한된 환경)
  - 테스트 케이스 검증
  - 정오답 판정
  - 실행 시간 측정 (time 모듈 기준)
  - 메모리 사용량 측정 (psutil 사용)
  - 악의적 코드 패턴 탐지 (AST 정적 분석)
  - 채점 큐 관리 (최대 500개)
- **제약사항**
  - **허용 모듈**: Python 표준 라이브러리 중 안전한 모듈만
    - 허용: math, random, itertools, collections, string, re, datetime, json 등
  - **금지 모듈**:
    - 시스템: os, subprocess, multiprocessing, threading
    - 네트워크: socket, urllib, http, requests
    - 파일 시스템: pathlib (일부), shutil, tempfile
    - 동적 실행: eval, exec, compile, **import**
    - 기타: sys (일부 함수만 허용)
  - **파일 I/O**: open() 함수 사용 시 임시 디렉토리 내부만 허용
  - **네트워크 접근**: 전면 차단 (import 단계에서 차단)
  - **프로세스 생성**: 차단 (subprocess, os.system 등)
  - **코드 검증**: 제출 전 AST 파싱으로 금지 패턴 검사

#### 채점 결과 (Judging Result)

- **속성**
  - 결과 ID (PK, 자동 생성)
  - 제출 ID (FK)
  - 채점 상태
  - 통과한 테스트 케이스 수
  - 전체 테스트 케이스 수
  - 실행 시간 (최대 실행 시간, ms)
  - 메모리 사용량 (최대 메모리 사용량, MB)
  - 에러 메시지 (Runtime Error 시)
  - 채점 완료 시각
- **상태**
  - 정답 (Accepted, AC)
  - 오답 (Wrong Answer, WA)
  - 시간 초과 (Time Limit Exceeded, TLE)
  - 런타임 에러 (Runtime Error, RE)
  - 문법 에러 (Syntax Error, SE)
  - 메모리 초과 (Memory Limit Exceeded, MLE)

### 2.4 교육 세션 관리 (Education Session Management)

#### 교육 세션 (Education Session)

- **속성**
  - 세션 ID (PK, 자동 생성)
  - 세션 이름
  - 시작 시각
  - 종료 시각
  - 세션 상태 (예정/진행중/종료)
  - 대상 학생 목록
  - 할당된 문제 목록
  - 세션 타입 (정규/모의고사/연습)
  - 재제출 허용 여부
  - 생성자 (관리자 ID)
  - 생성일
  - 수정일
- **행위**
  - 세션 생성
  - 세션 시작/종료
  - 세션 초기화 (문제 해결 내역 및 스코어보드 리셋)
  - 학생 추가/제거
  - 문제 추가/제거

#### 스코어보드 (Scoreboard)

- **속성**
  - 학생별 점수
  - 학생별 문제 해결 수
  - 학생별 정답률
  - 순위
- **행위**
  - 실시간 스코어보드 갱신
  - 세션별 스코어보드 조회

#### 학업 성취도 평가 (Academic Achievement Assessment)

- **지표**
  - 카테고리별 정답률
  - 문제 세트별 완성도
  - 제출 시도 횟수
  - 평균 해결 시간
- **행위**
  - 학생별 성취도 분석
  - 전체 학생 성취도 통계
  - 성취도 리포트 생성

### 2.5 보안 관리 (Security Management)

#### 코드 실행 샌드박스 (Code Execution Sandbox)

- **속성**
  - 샌드박스 ID (PK, 자동 생성)
  - 실행 환경 ID
  - Python 버전
  - 허용 모듈 목록 (화이트리스트)
  - 금지 모듈 목록 (블랙리스트: os, subprocess, socket, sys 등)
  - 금지 함수 목록 (eval, exec, compile, **import** 등)
  - CPU 시간 제한 (초)
  - 메모리 제한 (MB)
  - 실행 타임아웃 (초)
  - 임시 디렉토리 경로
  - 생성일
  - 수정일
- **행위**
  - 코드 정적 분석 (AST 파싱으로 악의적 패턴 탐지)
  - 별도 프로세스로 코드 실행 (subprocess.run)
  - 리소스 사용량 모니터링 (resource 모듈, psutil)
  - 위험 행위 차단 및 로그 기록
  - 임시 디렉토리 생성 및 정리
  - 실행 타임아웃 강제 종료
- **보안 정책**
  - **정적 분석**
    - AST(Abstract Syntax Tree) 파싱으로 금지 모듈/함수 사용 검증
    - import 문 화이트리스트 검증
    - 위험 패턴 탐지 (eval, exec, **import**, open 등)
  - **프로세스 격리**
    - subprocess.run으로 별도 프로세스 실행
    - timeout 파라미터로 실행 시간 제한
    - Python의 resource 모듈로 메모리/CPU 제한 (Unix 계열)
  - **파일 시스템 제한**
    - 임시 디렉토리만 읽기/쓰기 허용
    - 절대 경로 사용 차단
    - 상위 디렉토리 접근 차단 (../ 금지)
  - **네트워크 차단**
    - socket, urllib, requests 등 네트워크 모듈 import 차단
    - 코드 정적 분석으로 사전 검증
  - **기타 제한**
    - 표준 입력만 허용, 파일 입력은 지정된 경로만
    - 표준 출력만 허용
    - 환경변수 접근 제한

#### 접근 제어 (Access Control)

- **속성**
  - 권한 ID (PK, 자동 생성)
  - 사용자 ID (FK)
  - 사용자 역할 (학생/관리자/최고관리자)
  - 권한 목록
  - 권한 부여일
  - 권한 만료일 (선택)
- **행위**
  - 권한 검증
  - 역할 기반 접근 제어 (RBAC)
  - 접근 로그 기록
  - 비정상 접근 탐지 및 차단
- **권한 정의**
  - **학생 권한**: 문제 조회, 코드 제출, 자신의 제출 이력 조회, 스코어보드 조회
  - **관리자 권한**: 학생 권한 + 문제 등록/수정/삭제, 테스트 케이스 관리, 세션 생성/관리, 전체 학생 조회
  - **최고관리자 권한**: 관리자 권한 + 관리자 계정 관리, 시스템 설정, 데이터 백업/복구

#### 감사 로그 (Audit Log)

- **속성**
  - 로그 ID (PK, 자동 생성)
  - 사용자 ID (FK)
  - 사용자 역할
  - 행위 유형 (로그인, 문제 등록, 제출, 세션 생성 등)
  - 대상 리소스 (문제 ID, 세션 ID 등)
  - IP 주소
  - User Agent
  - 수행 시각
  - 결과 (성공/실패)
  - 에러 메시지 (실패 시)
- **행위**
  - 모든 중요 행위 로그 기록
  - 로그 조회 및 검색
  - 의심스러운 활동 탐지
  - 로그 보관 및 아카이빙 (90일)
- **로그 대상 행위**
  - 인증: 로그인/로그아웃 시도
  - 관리: 문제 등록/수정/삭제, 세션 생성/초기화
  - 제출: 코드 제출, 채점 결과
  - 보안: 접근 거부, 비정상 행위 탐지

## 3. 비즈니스 규칙

1. **회원가입 규칙**

   - **필수 입력 항목**: 군번, ID, 이름, 비밀번호
   - **군번 형식**: 영문/숫자/하이픈(-) 허용, 5-20자
   - **ID 형식**: 영문+숫자 조합, 4-20자, 특수문자 불가
   - **이름 형식**: 2-50자, 한글/영문 허용
   - **비밀번호 형식**: 8-100자, 영문+숫자+특수문자 조합 권장
   - **고유성 검증**: 군번과 ID는 데이터베이스에서 고유해야 함
   - **비밀번호 저장**: bcrypt 또는 argon2로 암호화하여 저장

2. **문제 출제 규칙**

   - **카테고리 분류**: 문제는 교육 과정 순서에 따라 11개 카테고리로 분류
   - **문제 세트**: 특정 카테고리 이후 종합 평가를 위한 5개 문제 세트 제공
     - 조건문 문제 세트 (카테고리 2 이후)
     - 반복문 문제 세트 (카테고리 5 이후)
     - 딕셔너리 문제 세트 (카테고리 6 이후)
     - 파일 입/출력 문제 세트 (카테고리 8 이후)
     - 예외 처리 문제 세트 (카테고리 10 이후)
   - **테스트 케이스 수**: 문제당 최소 10개, 최대 50개
   - **공개 테스트 케이스**: 1-3개 (전체의 10-30%)
   - **시간 제한**: 문제별 1-10초 (기본값: 2초)
   - **메모리 제한**: 256MB (고정)

3. **채점 규칙**

   - **정답 판정 기준**

     - 모든 비공개 테스트 케이스를 100% 통과해야 정답 (Accepted)
     - 하나라도 실패 시 오답 (Wrong Answer)
     - 부분 점수 없음 (All or Nothing)

   - **테스트 케이스 공개 정책**

     - 학생은 문제당 1-3개의 공개 예제 테스트 케이스만 확인 가능
     - 비공개 테스트 케이스는 10-50개 범위
     - 어떤 비공개 테스트 케이스에서 실패했는지 비공개
     - 전체 테스트 케이스 수는 공개하지 않음

   - **실행 제한**

     - **시간 제한**: 문제별 1-10초 (CPU 시간 기준)
     - **메모리 제한**: 256MB
     - **코드 크기 제한**: 최대 64KB
     - **파일 I/O**: 허용 (지정된 경로만)
     - **네트워크 접근**: 전면 차단
     - **외부 라이브러리**: Python 표준 라이브러리만 허용

   - **출력 비교 방식 (답안 정규화)**

     Python Judge는 학생 코드의 출력을 예상 출력과 비교할 때, 형식적인 차이로 인한 오답 판정을 방지하기 위해 다음과 같은 정규화 과정을 거칩니다:

     - **기본 원칙**: 의미적으로 동일한 출력은 정답으로 처리

     - **공백 정규화**

       - 각 줄의 trailing whitespace (줄 끝 공백) 제거
       - 각 줄의 leading whitespace (줄 시작 공백) 유지 (의미 있는 들여쓰기)
       - 연속된 공백은 유지 (문제에서 요구할 수 있음)

     - **줄바꿈 정규화**

       - LF (`\n`), CRLF (`\r\n`), CR (`\r`) 모두 동일하게 처리
       - 마지막 줄의 trailing newline 유무는 무시
       - 출력 전체의 leading/trailing empty lines 제거

     - **대소문자 구분**

       - 기본적으로 대소문자 구분 (case-sensitive)
       - 문제별로 case-insensitive 옵션 설정 가능 (관리자)

     - **부동소수점 비교**

       - 정수는 정확히 일치해야 함
       - 실수(float)는 상대 오차 1e-9 이내 허용
       - 과학적 표기법 (1e5, 1.5E-3 등) 지원

     - **정규화 예시**

       ```
       학생 출력: "Hello, World!  \n\n"
       예상 출력: "Hello, World!\n"
       결과: ✅ 정답 (trailing whitespace 및 빈 줄 무시)

       학생 출력: "123\r\n456\r\n"  (Windows)
       예상 출력: "123\n456\n"      (Linux)
       결과: ✅ 정답 (줄바꿈 문자 정규화)

       학생 출력: "3.14159265"
       예상 출력: "3.14159266"
       결과: ✅ 정답 (상대 오차 1e-9 이내)

       학생 출력: "Hello,World!"
       예상 출력: "Hello, World!"
       결과: ❌ 오답 (의미 있는 공백 차이)
       ```

   - **채점 응답 시간**
     - 평균 응답 시간: 5초 이내
     - 최대 응답 시간: 10초 (Vercel 서버리스 함수 한도 기준, Pro 플랜 전환 시 60초까지 확장 가능)
     - 10초 초과 시 타임아웃 에러

4. **세션 관리 규칙**

   - **세션 초기화 권한**: 관리자만 가능
   - **초기화 범위**: 특정 세션의 모든 제출 이력과 스코어보드 리셋
   - **초기화 기준 시점**: 관리자가 지정한 특정 시각 이후의 데이터만 삭제 가능
   - **복구 불가**: 초기화된 데이터는 복구 불가 (경고 메시지 필수)
   - **감사 로그**: 세션 초기화 시 누가, 언제, 어떤 세션을 초기화했는지 기록
   - **동시 세션**: 학생은 여러 세션에 동시 참여 가능
   - **세션 상태 전환**
     - 예정 → 진행중: 시작 시각 도래 시 자동 전환
     - 진행중 → 종료: 종료 시각 도래 시 자동 전환 또는 관리자 수동 종료

5. **제출 규칙**

   - **채점 큐 제한**: 전체 시스템 최대 500개 제출까지 큐에 대기 가능
   - **큐 초과 시**: 429 Too Many Requests 에러 반환
   - **세션 시간 외 제출**: 세션 종료 후 제출 시 403 Forbidden 에러
   - **Python 버전 선택**: 학생이 3.8, 3.9, 3.10, 3.11, 3.12 중 선택 가능

6. **보안 규칙**

   - **인증**

     - JWT 토큰 기반 인증
     - 토큰 유효 시간: 2시간
     - 자동 로그아웃: 2시간 비활성 시

   - **코드 실행 보안**

     - **정적 분석**: AST 파싱으로 제출 전 코드 검증
     - **별도 프로세스 실행**: subprocess.run으로 격리 실행
     - **금지 모듈**: os, subprocess, socket, urllib, sys (일부), eval, exec
     - **허용 모듈**: math, random, itertools, collections, string, re, datetime, json 등
     - **파일 시스템**: 임시 디렉토리 내부만 접근 허용
     - **리소스 제한**:
       - resource 모듈로 메모리/CPU 제한 (Unix)
       - psutil로 메모리 사용량 모니터링
       - subprocess timeout으로 실행 시간 제한
     - **프로세스 생성 차단**: subprocess, multiprocessing 모듈 import 차단
     - **네트워크 차단**: socket 관련 모듈 import 차단

   - **접근 제어**

     - 역할 기반 접근 제어 (RBAC)
     - 학생: 자신의 데이터만 조회 가능
     - 관리자: 모든 학생 데이터 조회 가능
     - 최고관리자: 시스템 전체 설정 가능

   - **감사 로그**
     - 모든 중요 행위 로그 기록
     - 로그 보관 기간: 90일
     - 로그 접근 권한: 최고관리자만

## 4. 시스템 경계

### 포함 범위

- 웹 기반 사용자 인터페이스
- Python 코드 실행 및 자동 채점 엔진
- 사용자 인증 및 권한 관리
- 문제 및 테스트 케이스 관리
- 제출 이력 및 통계 관리

### 제외 범위

- 타 프로그래밍 언어 지원
- 실시간 코드 에디터 (IDE 기능)
- 학생 간 코드 공유 및 협업 기능
- 외부 시스템 연동 (LMS 등)
- Docker/컨테이너 기반 실행 환경 (Python 프로세스 격리로 대체)

## 5. 주요 시나리오

### 5.1 학생 문제 풀이 시나리오

1. 학생이 로그인
2. 카테고리별 문제 목록 조회
3. 특정 문제 선택 및 문제 내용 확인
4. Python 코드 작성
5. 코드 제출
6. 자동 채점 결과 확인 (정답/오답)
7. 스코어보드에서 자신의 순위 확인

### 5.2 관리자 문제 관리 시나리오

1. 관리자가 로그인
2. 새로운 문제 등록
3. 문제 설명 및 예제 입출력 작성
4. 테스트 케이스 등록 (공개/비공개 구분)
5. 카테고리 및 문제 세트 할당
6. 문제 공개

### 5.3 교육 세션 관리 시나리오

1. 관리자가 새로운 교육 세션 생성
2. 대상 학생 및 문제 세트 설정
3. 세션 시작
4. 학생들의 실시간 제출 현황 모니터링
5. 스코어보드 확인
6. 세션 종료 후 성취도 평가 리포트 생성
